<!DOCTYPE html>
<html>
  <head>
   <!-- <base href="<%=basePath%>">-->
    <title>设备信息</title>
    <link rel="stylesheet" type="text/css" href="../../css/ywglCommon.css"/>
    <link rel="stylesheet" type="text/css" href="../../js/easyui/themes/default/easyui.css">   
		<link rel="stylesheet" type="text/css" href="../../js/easyui/themes/icon.css">  
    <script type="text/javascript" src="../../js/easyui/jquery.min.js"></script>   
		<script type="text/javascript" src="../../js/easyui/jquery.easyui.min.js"></script> 
  	<script type="text/javascript" src="../../js/easyui/locale/easyui-lang-zh_CN.js"></script>
		<meta http-equiv="pragma" content="no-cache">
		<meta http-equiv="cache-control" content="no-cache">
		<meta http-equiv="expires" content="0">    
		<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
		<meta http-equiv="description" content="This is my page">
  </head>
  
  <body style="padding:5px;">
  	<div class="easyui-layout" fit="true" border="false">
		    <div region="center" border="false">
					<div class="SearchCondition" id="tbar">
								<!--查找条件：这里到时可以替换 -->
								  <table border="0" cellpadding="0" cellspacing="0" width="100%">
										<tbody>
											<tr>
												<td style="width: 5px; border-bottom: 2px solid #C0C0C0;">&nbsp;</td>
												<td style="border-bottom: 2px solid #F3F2F2;" valign="bottom">
													<div style="background: #F3F2F2; border-top: 1px solid #C0C0C0; border-right: 1px solid #C0C0C0; border-left: 1px solid #C0C0C0;">
														<div style="border-top: 1px solid #FFFFFF; border-right: 1px solid #FFFFFF; border-left: 1px solid #FFFFFF; background: transparent url(../../css/TabGradientA.xhtml) repeat-x; padding: 3px 5px;">
																<table border="0" cellpadding="0" cellspacing="0">
																	<tbody>
																		<tr>
																				<td nowrap="nowrap"><div style="text-align: left; -webkit-appearance: none; border: 0; background: none; padding: 0; background-image: url(../../img/binocle.png); background-repeat: no-repeat; text-indent: 18px;">
																						<span>查询条件</span></div>
																				</td>
																				<td>&nbsp;</td>
																				<td> &nbsp;&nbsp;&nbsp;</td>
																		</tr>
																	</tbody>
																</table>
														</div>
													</div>
												</td>
												<td style="width: 95%; border-bottom: 2px solid #C0C0C0; text-align:right; padding-right:20px;"></td>
											</tr>
										</tbody>
								  </table>
							<!--查找条件：这里到时可以替换 end -->
							<form id="ff" action="">
										<table class="SearchCondition" >
								    		<tr>
													<td>局站：<input class="easyui-combobox" id="juZhan" name="juZhan" style="width:175px"></input></td>
													<td>机房：<input class="easyui-combobox" id="jiFang" name="jiFang"  style="width:175px"></td>
													<td>机柜：<input class="easyui-combobox" id="cabinetId" name="cabinetId"  style="width:150px"></input></td>
								    		</tr>
								   		 	<tr>
								   		 	 	<td>网元编号：<input id="gridId" placeHolder="请输入网元编号.." name="gridId"  style="width:150px"></input></td>
													<td>设备名称：<input id="equipmentName" placeHolder="请输入设备名称.." name="equipmentName"  style="width:150px"></input></td>
								    		</tr>
												<tr>
													<td colspan="8">
														<div style="text-align:center;padding:5px">
													    	<input type="button" class="button" id="btnSearch" value="查询" onclick="javascript:sbxxQuery();"/>
													    	<input type="button" class="button" id="btnClearForm" value="重置" onclick="javascript:resert();"/>
										    				<input type="button" class="button" id="btnClearForm" value="批量导入" onclick="javascript:inserts();"/>
										    			</div>
													</td>
													<td></td>
													<td></td>
													<td></td>
												</tr>
						    		</table>
						  </form>
					</div>
					<table fit="true" style="width:1050px;" id="lstResult" class="easyui-datagrid" title="设备-列表" iconCls="icon-comment_edit" pageSize="20" url="" rownumbers="true" 
						striped="true" remoteSort="true" pagination="true" singleSelect="false" toolbar="#tbar">
					</table>
			
					<div id="cardInfo" class="easyui-window" closed="true" title="板卡信息"  
				 	 	style="width:1100px;padding:5px;">
						<table style="width:1060px;" id="lstCardInfos" class="easyui-datagrid"  pageSize="20" url="" rownumbers="true" 
							striped="true" remoteSort="true"  pagination="true" singleSelect="false" >
						</table>
					</div>
			
			</div>
   </div>
 </body>
  
  <script type="text/javascript">
	function exc(){
		var rows = $('#lstResult').datagrid('getRows');
 		if (!rows || rows.length == 0) {
			$.messager.alert('提示信息','没有可供导出的数据');
			return false; 
		}
		var strUrl = '<%=path%>/jgxx/initJgxxListPage.do?';
		window.location.href=strUrl;
	}
    /* $.messager.progress({
  		title: '',
		msg: '',
		text: '加载中，请稍后',
		interval:790
  	});
  	setTimeout(function(){$.messager.progress('close');},2000); */
  	
	$('#juZhan').combobox({
		url:'<%=path%>/jgxx/juzhan_list_search.do',
	    valueField:'REGION_ID',
	    textField:'REGION_NAME',
	    method:'get',
	    
	    onChange : function(){//局站添加onChange事件。
            var regionId = $("#juZhan").combobox("getValue") ;           
            //1.清空原来的机房combobox中的选项
            $("#jiFang").combobox("clear");     
            
            //2.动态添加"机房"的下拉列表框的option                    
            if( regionId != null && regionId != '' ){//2
            	//alert("rek====="+regionId);
            	$('#jiFang').combobox({
            		url:"<%=path%>/jgxx/jifang_list_search.do?regionId="+regionId,
            		
            	    valueField:'ROOM_ID',
            	    textField:'ROOM_NO',
             	    method:'get',
             	    //Onchange
             	    	onChange : function(){//局站添加onChange事件。
             	            var roomId = $("#jiFang").combobox("getValue") ;           
             	            //1.清空原来的机柜combobox中的选项
             	            $("#cabinetId").combobox("clear");     
             	            
             	            //2.动态添加"机柜"的下拉列表框的option                    
             	            if( roomId != null && roomId != '' ){//2
             	            	//alert("rek====="+regionId);
             	            	$('#cabinetId').combobox({
             	            		url:"<%=path%>/sbxx/cabinet_list_search.do?roomId="+roomId,
             	            		
             	            	    valueField:'CABINET_ID',
             	            	    textField:'CABINET_NAME',
             	             	    method:'get'
             	            	});
             	            }//-2
             			   }//onchange 结束
             	    //onchange end
            	});
            }//-2
		   }//onchange 结束
	    });
	
//	<%-- $('#zhuanYe').combobox({
//		url:'<%=path%>/jgxx/zhuanye_list_search.do',
//	    valueField:'SPEC_ID',
//	    textField:'SPEC_NAME',
//	   // value:'--请选择机柜专业--',
//	    method:'get'
//	}); --%>
	
	var a="";
	function batchUpdateGrid(){
	 	a="";
		var datas=$('#lstResult').datagrid('getSelections');
		if(datas.length==0){
			alert("请至少选择一行");
			return;
		}
		for(var i=0;i<datas.length;i++){
			a+=datas[i].ASSETS_NUMBER;
			a+="-";
		}
		$("#batchUpdateGridDiv").dialog({
			title:'选择网格',
			width:300,
			height:150,
			closed:false,
			modal:true
		});
	}
	function batchSubUpdateGrid(){
		var gridNum=$("#roadAddGridName1").combobox("getValue");
		$.ajax({
			async:false,
			url:'<%=path%>/ywgl/NuGridbatchAddAssGrid.do',
			dataType:"text",
			data: {assetNum:a,flag:"资产",gridNum:gridNum},
			success:(function(data){
				if(data==1){
					$('#win').window({ 
						title:"数据同步提示",
						modal:true,
						closed:false
						//maximized:true
					}); 
					$("#yesBut").attr("onclick","javascript:subBatchSynAddGrid(\""+a+"\",\""+gridNum+"\",1);");
					$("#noBut").attr("onclick","javascript:subBatchSynAddGrid(\""+a+"\",\""+gridNum+"\",0);");
					$('#nuResult').datagrid({
				        url:'<%=path%>/ywgl/NuGridselMoreSynNu.do',
						queryParams: {  		
							assetNum:a,
							gridNum:gridNum
						},
				        columns:[[
				             {title:'网元id',field:'NU_ID',align:'left',hidden:true},
				             {title:'网格名称',field:'GRID_NAME',width:'100',align:'left'},
				             {title:'网元名称',field:'NU_NAME',width:'200',align:'left'},
				             {title:'网元地址',field:'NU_ADDRESS',width:'200',align:'left'},
				             {title:'站点',field:'SITE_NAME',width:'100',align:'left'},
				             {title:'机房',field:'ROOM_NAME',width:'100',align:'left'},
						     {title:'专业',field:'NU_SPEC_NAME',width:'100',align:'left'},
				             {title:'网元所在区局',field:'YW_REGION',width:'100',align:'left'},
						     {title:'厂商',field:'MANUFACTURER_NAME',width:'200',align:'left'}
						]],
				        method:'post'
				    });
				}else{
					alert("保存成功");
					$('#lstResult').datagrid("reload");
					$("#batchUpdateGridDiv").dialog({
						closed:true
					});
				}
			}),
			method:"post"
		});
	}
	function subBatchSynAddGrid(assetNum,gridNum,isSyn){
		var datas=$('#nuResult').datagrid("getRows");		
		var nuId="";
		for(var i=0;i<datas.length;i++){
			nuId+=datas[i].NU_ID;
			nuId+="-";
		}
		$.ajax({
			async:false,
			dataType:"text",
			url:'<%=path%>/ywgl/NuGridbatchAddAssGrid.do',
			data:{assetNum:assetNum,gridNum:gridNum,isSyn:isSyn,nuId:nuId,flag:"资产"},
			success:(function(data){
				$('#win').window({ 
					closed:true
				}); 
				alert("保存成功");
				$('#lstResult').datagrid("reload");
				$("#batchUpdateGridDiv").dialog({
					closed:true
				});
			})
		});
	}
	
	function resetJiFang(){
		//var data=;
		$('#jiFang').combobox({
		valueField:'ROOM_ID',
	    textField:'ROOM_NO',
	    data:[{ROOM_ID:"",ROOM_NO:"" }]
		});
	}
	function resetCabinet(){
		//var data=;
		$('#cabinetId').combobox({
		valueField:'CABINET_ID',
	    textField:'CABINET_NAME',
	    data:[{"CABINET_ID":"","CABINET_NAME":"" }]
		});
	}
	function resert(){
		
		$("#jiFang").combobox("clear"); 
		$("#cabinetId").combobox("clear"); 
		$("#juZhan").combobox("setValue","");
		$("#jiFang").combobox("setValue","");
		/* //alert("aja");
		resetJiFang(); */
		$("#cabinetId").combobox("setValue","");
		/* resetCabinet();
		//$("#cabinetId").empty(); */
		$("#gridId").val("");
		$("#equipmentName").val("");
	}
	
	//批量导入进入选 择文件页面
	function inserts(){
		var cabinetId=$("#cabinetId").combobox("getValue");
		
		if(cabinetId==null||cabinetId==""){
			alert("请选择任意一个机柜为其批量添加设备！");
			return ;
		}
		window.open('<%=path%>/ywgl/showRoom/importEquipmentList.jsp?cabinetId='+cabinetId,'newwindow','resizable=yes,scrollbars=yes,height=650,width=600,top=200,left=200');
	}
	
	
	function sbxxQuery(){
		$('#lstResult').datagrid('loadData', { total: 0, rows: [] });
		
		var juZhan=$("#juZhan").combobox("getValue");
		var jiFang=$("#jiFang").combobox("getValue");
		var cabinetId=$("#cabinetId").combobox("getValue");
		
		var gridId=document.getElementById("gridId").value; 
		var equipmentName=document.getElementById("equipmentName").value;
		
		$('#lstResult').datagrid({
				pageNumber:1,
				pageSize: 20,//每页显示的记录条数，默认为10  
                pageList: [10, 20,50,100, 200],//可以设置每页记录条数的列表 //   ywgl/ziChanGrid_list_seach.do
		        url:'<%=path%>/sbxx/SbxxListQuery.do', 
		         queryParams: {  		
		        		
		        	 juZhan:juZhan, 	
		        	 jiFang:jiFang,
		        	 cabinetId:cabinetId,
		        	 gridId:gridId,
		        	 equipmentName:equipmentName
				  },
		        columns:[[
		        	//ASSETS_NUMBER, ASSETS_DESCRIBE, ASSETS_MANUFACTURER, ADDRESS, OBJ_DEPT_DESCRIBE, DEPT_DESCRIBE
		             //{field:'flag',checkbox:true},
		             //{title:'序号',field:'ID',width:'200',align:'left',hidden:true},
		             {title:'设备ID',field:'EQUIP_ID',width:'60',align:'left',hidden:true}, 
		             {title:'机房名称',field:'ROOM_NO',width:'200',align:'left'},
		             {title:'机柜编号',field:'CABINET_NUM',width:'60',align:'left'},
		             {title:'机柜面',field:'CABINET_SURFACE',width:'100',align:'left'},
		             {title:'网元编号',field:'NU_NUM',width:'200',align:'left'},
		             
		             {title:'设备名称',field:'EQUIP_NAME',width:'250',align:'left'},
		             {title:'设备专业',field:'SPEC_NAME',width:'80',align:'left'},
		             {title:'设备厂商',field:'MANUFACTURER',width:'150',align:'left'},
		             {title:'设备类型',field:'CATEGORY',width:'100',align:'left'},
		             
		             {title:'设备型号',field:'MODEL',width:'100',align:'left'},
		             {title:'子框数量',field:'SUB_RACK_COUNT',width:'100',align:'left'},
		             {title:'板卡信息',field:'UPDATE',width:'150',align:'left',formatter:CardInfo},
		             
				   	]],
		        method:'post'
		    });
	}
	//板卡信息按钮
	function CardInfo(value,rowData,rowIndex){
    	var link="<a href='javascript:showCard(" + rowData.EQUIP_ID + ")'>"+'板卡信息'+"</a>";
    	return link;
    }
	//弹出板卡信息详情
	function showCard(equipId)
    {
		//$("#cardInfo").empty();	
		$('#lstCardInfos').datagrid('loadData', { total: 0, rows: [] });
		$('#lstCardInfos').datagrid({
				pageNumber:1,
				pageSize: 10,//每页显示的记录条数，默认为10  
                pageList: [10,20,50],//可以设置每页记录条数的列表 //   ywgl/ziChanGrid_list_seach.do
		        url:'<%=path%>/sbxx/gotoCardInfo.do', 
		         queryParams: {  		
		        	 equipId:equipId
				  },
		        columns:[[
		             {title:'板卡ID',field:'CARD_ID',width:'60',align:'left',hidden:true}, 
		             {title:'子框ID',field:'SUB_RACK_ID',width:'60',align:'left',hidden:true},
		             {title:'所占槽位数',field:'OCCUPY_SLOT_NUM',width:'100',align:'left'},
		             {title:'板卡厂商',field:'MANUFACTURER',width:'150',align:'left'},
		             {title:'板卡用途',field:'PURPOSE',width:'150',align:'left'},
		             
		             {title:'板卡类型',field:'CATEGORY',width:'250',align:'left'},
		             {title:'板卡型号',field:'MODEL',width:'100',align:'left'},
		             {title:'固定资产编号',field:'ASSET_NO',width:'150',align:'left'},
		             {title:'位置数',field:'POS_IDX',width:'60',align:'left'},
		             {title:'板卡更换日期',field:'CHANGE_DATE',width:'100',align:'left'},
		            
				   	]],
		        method:'post'
		    });
		$('#cardInfo').window({
			modal:true});
		$('#cardInfo').window('open');
		
    }
    
  </script>
</html>
